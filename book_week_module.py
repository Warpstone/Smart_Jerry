# -*- coding: utf-8 -*-
# pylint: disable=non-ascii-bytes

import random
import requests
import json

# API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
GOOGLE_BOOKS_API_URL = "https://www.googleapis.com/books/v1/volumes"
OPEN_LIBRARY_API_URL = "https://openlibrary.org/search.json"

# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–Ω–∏–≥
BOOK_CATEGORIES = [
    "fiction", "business", "psychology", "philosophy", 
    "self-help", "history", "computer science", "technology",
    "biography", "science", "art", "literature"
]

# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è Open Library (–∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç)
OPEN_LIBRARY_SUBJECTS = [
    "Fiction", "Business", "Psychology", "Philosophy", 
    "Self-help", "History", "Computer science", "Technology",
    "Biography", "Science", "Art", "Literature"
]

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (fallback)
BOOKS_DATABASE = {
    "—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è": [
        {
            "title": "1984",
            "author": "–î–∂–æ—Ä–¥–∂ –û—Ä—É—ç–ª–ª",
            "description": "–ê–Ω—Ç–∏—É—Ç–æ–ø–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω –æ —Ç–æ—Ç–∞–ª–∏—Ç–∞—Ä–Ω–æ–º –æ–±—â–µ—Å—Ç–≤–µ, –≥–¥–µ –∫–∞–∂–¥—ã–π —à–∞–≥ —á–µ–ª–æ–≤–µ–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –ë–æ–ª—å—à–∏–º –ë—Ä–∞—Ç–æ–º. –ö–ª–∞—Å—Å–∏–∫–∞ –º–∏—Ä–æ–≤–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã, –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏ —Å–µ–≥–æ–¥–Ω—è.",
            "rating": "4.8/5"
        },
        {
            "title": "–ú–∞—Å—Ç–µ—Ä –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞",
            "author": "–ú–∏—Ö–∞–∏–ª –ë—É–ª–≥–∞–∫–æ–≤",
            "description": "–ú–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω –æ –¥–æ–±—Ä–µ –∏ –∑–ª–µ, –ª—é–±–≤–∏ –∏ –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ. –ò—Å—Ç–æ—Ä–∏—è –æ –≤–∏–∑–∏—Ç–µ –¥—å—è–≤–æ–ª–∞ –≤ –ú–æ—Å–∫–≤—É 1930-—Ö –≥–æ–¥–æ–≤.",
            "rating": "4.9/5"
        },
        {
            "title": "–í–æ–π–Ω–∞ –∏ –º–∏—Ä",
            "author": "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π",
            "description": "–≠–ø–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω –æ –≤–æ–π–Ω–µ 1812 –≥–æ–¥–∞ –∏ –∂–∏–∑–Ω–∏ —Ä—É—Å—Å–∫–æ–≥–æ –æ–±—â–µ—Å—Ç–≤–∞. –û–¥–Ω–∞ –∏–∑ –≤–µ–ª–∏—á–∞–π—à–∏—Ö –∫–Ω–∏–≥ –º–∏—Ä–æ–≤–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã.",
            "rating": "4.7/5"
        }
    ],
    "–±–∏–∑–Ω–µ—Å": [
        {
            "title": "–ë–æ–≥–∞—Ç—ã–π –ø–∞–ø–∞, –±–µ–¥–Ω—ã–π –ø–∞–ø–∞",
            "author": "–†–æ–±–µ—Ä—Ç –ö–∏–π–æ—Å–∞–∫–∏",
            "description": "–ö–Ω–∏–≥–∞ –æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ –∏ –º—ã—à–ª–µ–Ω–∏–∏ –±–æ–≥–∞—Ç—ã—Ö –ª—é–¥–µ–π. –£—á–∏—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å –∞–∫—Ç–∏–≤—ã –∏ –ø–∞—Å—Å–∏–≤—ã.",
            "rating": "4.6/5"
        },
        {
            "title": "7 –Ω–∞–≤—ã–∫–æ–≤ –≤—ã—Å–æ–∫–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –ª—é–¥–µ–π",
            "author": "–°—Ç–∏–≤–µ–Ω –ö–æ–≤–∏",
            "description": "–ö–ª–∞—Å—Å–∏–∫–∞ –ª–∏—á–Ω–æ—Å—Ç–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è. –°–µ–º—å –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —É—Å–ø–µ—Ö–∞ –≤ –∂–∏–∑–Ω–∏ –∏ –∫–∞—Ä—å–µ—Ä–µ.",
            "rating": "4.8/5"
        },
        {
            "title": "–î—É–º–∞–π –∏ –±–æ–≥–∞—Ç–µ–π",
            "author": "–ù–∞–ø–æ–ª–µ–æ–Ω –•–∏–ª–ª",
            "description": "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–∞ –±–æ–≥–∞—Ç–µ–π—à–∏—Ö –ª—é–¥–µ–π –ê–º–µ—Ä–∏–∫–∏. 13 –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±–æ–≥–∞—Ç—Å—Ç–≤–∞.",
            "rating": "4.5/5"
        }
    ],
    "–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è": [
        {
            "title": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –≤–ª–∏—è–Ω–∏—è",
            "author": "–†–æ–±–µ—Ä—Ç –ß–∞–ª–¥–∏–Ω–∏",
            "description": "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –≤–ª–∏—è–Ω–∏—è –∏ —É–±–µ–∂–¥–µ–Ω–∏—è. –ö–∞–∫ –ª—é–¥–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ä–µ—à–µ–Ω–∏—è –∏ –∫–∞–∫ –Ω–∞ –Ω–∏—Ö –º–æ–∂–Ω–æ –≤–ª–∏—è—Ç—å.",
            "rating": "4.7/5"
        },
        {
            "title": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç",
            "author": "–î—ç–Ω–∏–µ–ª –ì–æ—É–ª–º–∞–Ω",
            "description": "–û –≤–∞–∂–Ω–æ—Å—Ç–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –≤ –∂–∏–∑–Ω–∏ –∏ –∫–∞—Ä—å–µ—Ä–µ. –ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å —ç–º–æ—Ü–∏—è–º–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —É—Å–ø–µ—Ö–∞.",
            "rating": "4.6/5"
        },
        {
            "title": "–¢–æ–Ω–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ –ø–æ—Ñ–∏–≥–∏–∑–º–∞",
            "author": "–ú–∞—Ä–∫ –ú—ç–Ω—Å–æ–Ω",
            "description": "–ü–∞—Ä–∞–¥–æ–∫—Å–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∂–∏–∑–Ω–∏. –û —Ç–æ–º, –∫–∞–∫ –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –ø–æ –º–µ–ª–æ—á–∞–º –∏ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –≤–∞–∂–Ω–æ–º.",
            "rating": "4.4/5"
        }
    ],
    "—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è": [
        {
            "title": "–¢–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ó–∞—Ä–∞—Ç—É—Å—Ç—Ä–∞",
            "author": "–§—Ä–∏–¥—Ä–∏—Ö –ù–∏—Ü—à–µ",
            "description": "–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π —Ç—Ä–∞–∫—Ç–∞—Ç –æ —Å–≤–µ—Ä—Ö—á–µ–ª–æ–≤–µ–∫–µ –∏ –≤–µ—á–Ω–æ–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏. –û–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –≤–ª–∏—è—Ç–µ–ª—å–Ω—ã—Ö –∫–Ω–∏–≥ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏.",
            "rating": "4.5/5"
        },
        {
            "title": "–ò—Å–∫—É—Å—Å—Ç–≤–æ –≤–æ–π–Ω—ã",
            "author": "–°—É–Ω—å-—Ü–∑—ã",
            "description": "–î—Ä–µ–≤–Ω–∏–π —Ç—Ä–∞–∫—Ç–∞—Ç –æ –≤–æ–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –ø—Ä–∏–º–µ–Ω–∏–º—ã–π –≤ –±–∏–∑–Ω–µ—Å–µ –∏ –∂–∏–∑–Ω–∏. –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø–æ–±–µ–¥—ã –≤ –ª—é–±–æ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ.",
            "rating": "4.8/5"
        },
        {
            "title": "–ú–µ–¥–∏—Ç–∞—Ü–∏–∏",
            "author": "–ú–∞—Ä–∫ –ê–≤—Ä–µ–ª–∏–π",
            "description": "–õ–∏—á–Ω—ã–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è —Ä–∏–º—Å–∫–æ–≥–æ –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞-—Å—Ç–æ–∏–∫–∞ –æ –∂–∏–∑–Ω–∏, —Å–º–µ—Ä—Ç–∏ –∏ –¥–æ–±—Ä–æ–¥–µ—Ç–µ–ª–∏.",
            "rating": "4.7/5"
        }
    ],
    "—Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ": [
        {
            "title": "–ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏",
            "author": "–î–∂–µ–π–º—Å –ö–ª–∏—Ä",
            "description": "–û —Ç–æ–º, –∫–∞–∫ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –±–æ–ª—å—à–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º. –°–∏—Å—Ç–µ–º–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–µ–∑–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫.",
            "rating": "4.8/5"
        },
        {
            "title": "–°–∏–ª–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ",
            "author": "–≠–∫—Ö–∞—Ä—Ç –¢–æ–ª–ª–µ",
            "description": "–û –≤–∞–∂–Ω–æ—Å—Ç–∏ –∂–∏–∑–Ω–∏ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º –º–æ–º–µ–Ω—Ç–µ. –ö–∞–∫ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Å—Ç—Ä–∞–¥–∞–Ω–∏–π —á–µ—Ä–µ–∑ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å.",
            "rating": "4.6/5"
        },
        {
            "title": "–î—É–º–∞–π –º–µ–¥–ª–µ–Ω–Ω–æ... —Ä–µ—à–∞–π –±—ã—Å—Ç—Ä–æ",
            "author": "–î–∞–Ω–∏—ç–ª—å –ö–∞–Ω–µ–º–∞–Ω",
            "description": "–û –¥–≤—É—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –º—ã—à–ª–µ–Ω–∏—è: –±—ã—Å—Ç—Ä–æ–π –∏ –º–µ–¥–ª–µ–Ω–Ω–æ–π. –ö–∞–∫ –º—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º —Ä–µ—à–µ–Ω–∏—è –∏ –≥–¥–µ –æ—à–∏–±–∞–µ–º—Å—è.",
            "rating": "4.7/5"
        }
    ],
    "–∏—Å—Ç–æ—Ä–∏—è": [
        {
            "title": "Sapiens: –ö—Ä–∞—Ç–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞",
            "author": "–Æ–≤–∞–ª—å –ù–æ–π –•–∞—Ä–∞—Ä–∏",
            "description": "–£–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑ –æ —Ç–æ–º, –∫–∞–∫ Homo sapiens —Å—Ç–∞–ª –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–º –≤–∏–¥–æ–º –Ω–∞ –ø–ª–∞–Ω–µ—Ç–µ.",
            "rating": "4.8/5"
        },
        {
            "title": "–ò—Å—Ç–æ—Ä–∏—è –†–æ—Å—Å–∏–∏",
            "author": "–°–µ—Ä–≥–µ–π –°–æ–ª–æ–≤—å–µ–≤",
            "description": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç—Ä—É–¥ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –†–æ—Å—Å–∏–∏ –æ—Ç –¥—Ä–µ–≤–Ω–µ–π—à–∏—Ö –≤—Ä–µ–º–µ–Ω –¥–æ XIX –≤–µ–∫–∞.",
            "rating": "4.6/5"
        },
        {
            "title": "–í—Ç–æ—Ä–∞—è –º–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞",
            "author": "–£–∏–Ω—Å—Ç–æ–Ω –ß–µ—Ä—á–∏–ª–ª—å",
            "description": "–í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∏–∑ –≥–ª–∞–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–æ–π–Ω—ã. –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–∑–≥–ª—è–¥ –Ω–∞ —Å–æ–±—ã—Ç–∏—è 1939-1945 –≥–æ–¥–æ–≤.",
            "rating": "4.7/5"
        }
    ],
    "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞": [
        {
            "title": "–ß–∏—Å—Ç—ã–π –∫–æ–¥",
            "author": "–†–æ–±–µ—Ä—Ç –ú–∞—Ä—Ç–∏–Ω",
            "description": "–û —Ç–æ–º, –∫–∞–∫ –ø–∏—Å–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥. –ü—Ä–∏–Ω—Ü–∏–ø—ã, –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤.",
            "rating": "4.8/5"
        },
        {
            "title": "–°–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º",
            "author": "–¢–∏–º –†–∞—Ñ–≥–∞—Ä–¥–µ–Ω",
            "description": "–í–≤–µ–¥–µ–Ω–∏–µ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö. –û—Ç –æ—Å–Ω–æ–≤ –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ç–µ—Ö–Ω–∏–∫.",
            "rating": "4.7/5"
        },
        {
            "title": "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç",
            "author": "–°—Ç—é–∞—Ä—Ç –†–∞—Å—Å–µ–ª",
            "description": "–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ –ò–ò. –û—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ –±—É–¥—É—â–∏—Ö –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤.",
            "rating": "4.6/5"
        }
    ]
}

def get_book_of_the_week():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–Ω–∏–≥—É –Ω–µ–¥–µ–ª–∏"""
    try:
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        category = random.choice(list(BOOKS_DATABASE.keys()))
        
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–Ω–∏–≥—É –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        book = random.choice(BOOKS_DATABASE[category])
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        message = f"""üìö *–ö–Ω–∏–≥–∞ –Ω–µ–¥–µ–ª–∏*

*{book['title']}* - {book['author']}
*–ö–∞—Ç–µ–≥–æ—Ä–∏—è:* {category.title()}
*–†–µ–π—Ç–∏–Ω–≥:* {book['rating']}

{book['description']}

üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∫ –ø—Ä–æ—á—Ç–µ–Ω–∏—é!"""
        
        return message
        
    except Exception as e:
        return f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥—É –Ω–µ–¥–µ–ª–∏. –û—à–∏–±–∫–∞: {e}"

def get_all_categories():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫–Ω–∏–≥"""
    return list(BOOKS_DATABASE.keys())

def get_books_count():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–∏–≥ –≤ –±–∞–∑–µ"""
    total = 0
    for category_books in BOOKS_DATABASE.values():
        total += len(category_books)
    return total

def get_book_from_google_books(category=None):
    """–ü–æ–ª—É—á–∞–µ—Ç –∫–Ω–∏–≥—É –∏–∑ Google Books API"""
    try:
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞
        if not category:
            category = random.choice(BOOK_CATEGORIES)
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
        params = {
            'q': f'subject:{category}',
            'maxResults': 20,
            'orderBy': 'relevance',
            'langRestrict': 'ru,en'  # –†—É—Å—Å–∫–∏–µ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –∫–Ω–∏–≥–∏
        }
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        response = requests.get(GOOGLE_BOOKS_API_URL, params=params, timeout=10)
        response.raise_for_status()
        
        data = response.json()
        
        if not data.get('items'):
            return None
        
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–Ω–∏–≥—É –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        book_data = random.choice(data['items'])
        volume_info = book_data.get('volumeInfo', {})
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–Ω–∏–≥–µ
        title = volume_info.get('title', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–Ω–∏–≥–∞')
        authors = volume_info.get('authors', ['–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä'])
        author = ', '.join(authors) if authors else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä'
        
        # –û–ø–∏—Å–∞–Ω–∏–µ
        description = volume_info.get('description', '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ')
        if len(description) > 300:
            description = description[:300] + '...'
        
        # –†–µ–π—Ç–∏–Ω–≥
        average_rating = volume_info.get('averageRating', 0)
        ratings_count = volume_info.get('ratingsCount', 0)
        rating_text = f"{average_rating}/5" if average_rating > 0 else "–ù–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞"
        
        # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        categories = volume_info.get('categories', [category])
        category_text = categories[0] if categories else category
        
        return {
            'title': title,
            'author': author,
            'description': description,
            'rating': rating_text,
            'category': category_text,
            'source': 'Google Books API'
        }
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏ –∏–∑ Google Books API: {e}")
        return None

def get_book_from_open_library(subject=None):
    """–ü–æ–ª—É—á–∞–µ—Ç –∫–Ω–∏–≥—É –∏–∑ Open Library API"""
    try:
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞
        if not subject:
            subject = random.choice(OPEN_LIBRARY_SUBJECTS)
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        params = {
            'subject': subject,
            'limit': 20,
            'sort': 'new'  # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –Ω–æ–≤–∏–∑–Ω–µ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
        }
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        response = requests.get(OPEN_LIBRARY_API_URL, params=params, timeout=15)
        response.raise_for_status()
        
        data = response.json()
        
        if not data.get('docs') or len(data['docs']) == 0:
            print(f"Open Library: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∫–Ω–∏–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '{subject}'")
            return None
        
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∫–Ω–∏–≥—É –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        book_data = random.choice(data['docs'])
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–Ω–∏–≥–µ
        title = book_data.get('title', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–Ω–∏–≥–∞')
        authors = book_data.get('author_name', ['–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä'])
        author = ', '.join(authors) if isinstance(authors, list) else str(authors)
        
        # –û–ø–∏—Å–∞–Ω–∏–µ (Open Library —á–∞—Å—Ç–æ –Ω–µ –∏–º–µ–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–π)
        description = book_data.get('first_sentence', ['–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ'])
        if isinstance(description, list) and description:
            description = description[0]
        elif not description:
            description = '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ'
        
        if len(description) > 300:
            description = description[:300] + '...'
        
        # –†–µ–π—Ç–∏–Ω–≥ (Open Library –Ω–µ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∏)
        rating_text = "–ù–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞"
        
        # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        subjects = book_data.get('subject', [subject])
        category_text = subjects[0] if subjects else subject
        
        
        return {
            'title': title,
            'author': author,
            'description': description,
            'rating': rating_text,
            'category': category_text,
            'source': 'Open Library'
        }
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏ –∏–∑ Open Library API: {e}")
        return None

def get_book_of_the_week_with_api():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–Ω–∏–≥—É –Ω–µ–¥–µ–ª–∏ –∏–∑ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞, Google Books, Open Library)"""
    # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
    available_sources = []
    
    # –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
    try:
        local_book = get_book_of_the_week()
        if local_book:
            available_sources.append(('local', local_book))
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã: {e}")
    
    # –î–æ–±–∞–≤–ª—è–µ–º Google Books API
    try:
        google_book = get_book_from_google_books()
        if google_book:
            available_sources.append(('google', google_book))
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏ –∏–∑ Google Books API: {e}")
    
    # –î–æ–±–∞–≤–ª—è–µ–º Open Library API
    try:
        open_lib_book = get_book_from_open_library()
        if open_lib_book:
            available_sources.append(('open_library', open_lib_book))
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏ –∏–∑ Open Library API: {e}")
    
    # –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π
    if available_sources:
        source_type, book_data = random.choice(available_sources)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        if source_type == 'local':
            # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            return book_data
        else:
            # –î–ª—è API —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            message = f"""üìö *–ö–Ω–∏–≥–∞ –Ω–µ–¥–µ–ª–∏*

*{book_data['title']}* - {book_data['author']}
*–ö–∞—Ç–µ–≥–æ—Ä–∏—è:* {book_data['category']}
*–†–µ–π—Ç–∏–Ω–≥:* {book_data['rating']}

{book_data['description']}

üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∫ –ø—Ä–æ—á—Ç–µ–Ω–∏—é!"""
            
            return message
    
    # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
    return "üìö *–ö–Ω–∏–≥–∞ –Ω–µ–¥–µ–ª–∏*\n\n–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–π—á–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ!"
